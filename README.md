# Запуск

Собрать и запустить Docker образ:
```
sudo docker build -t modelapi .
sudo docker run -p 8080:8080/tcp modelapi
```

Длительный запуск связан с обучением моделей, прогресс обучения у будет виден в косоли с помощью tqdm.

После того как появится сообщение:
```
INFO:     Uvicorn running on http://0.0.0.0:80 (Press CTRL+C to quit)
```
Можно узнать ip созданного контейнера и обратится к нему

```
http://172.17.0.2/docs
http://172.17.0.2/recomendation/?userid=1669366907607945389&fields_num=10&as_link=true
http://172.17.0.2/recomendation_and_viewed/?userid=1669366907607945389&fields_num=10&as_link=true
```

В случае если нет ответа от сервера по приведенным ссылкам проделайте следующее:
```
sudo docker inspect \
  --format '{{ .NetworkSettings.IPAddress }}' 3d5e74f5f966
```
Полученное значение использовать вместо 172.17.0.2 в ссылках (это значение стандартное для докера)

# Остановка сервиса

Остановка происходит по средству нажатия Ctrl + C в консоли, или команды docker stop.

В данном приложении важен graceful shutdown. В случае, если вы форсировали завершение (нажали несколько раз Ctrl + C), то перед запусом сервиса в следующий раз потребуется заново создать контейнер.

# Тесты

К сожалению пока только локальные

Запустить тесты из корня: 
```
pytest
```
Запустить канонизацию тестов из корня: 
```
pytest --canonize
```

# Настройка

В файле sensitive_settings.ini нужно указать данные для подключение к clickhouse серверу.